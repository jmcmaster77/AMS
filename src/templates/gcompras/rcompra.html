{% extends './base.html' %}

{% block title %} Admin me Store | Registro de compra {% endblock %}


{% block body %}
{% include('partials/_navbar.html') %}

<div class="card mb-1 text-white bg-dark mt-1">
    <div class="card-body">
        <div class="d-flex justify-content-between">
            <h5> Registro de compra</h5>
            <div class="btn-group">
                <a href="/home" class="btn btn-secondary btn-sm ">Inicio</a>
                <a href="{{ url_for('gcompras.compras') }}" class="btn btn-secondary btn-sm ">Retorno</a>
                <a href="{{ url_for('login.logout') }}" class="btn btn-secondary btn-sm " >Salir</a>
            </div>
        </div>

        <form action="/rcompras" method="post" class="mt-2">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            {% if proveedores == "No" %}
            <h6>No hay proveedores que seleccionar</h6>
            {% else %}
            <table>
                <thead>
                    <tr>
                        <th>Proveedor</th>
                        <th>Tipo de Compra</th>
                        <th>Metodo de Pago</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <input class="form-control" list="datalistprovOptions" id="proveedorDataList" name="proveedor" placeholder="Escriba para buscar..." required>
                            <datalist id="datalistprovOptions">
                            {% for proveedor in proveedores %}
                              <option value="{{ proveedor.fullname }}">
                            {% endfor %}
                            </datalist>
                        </td>
                        <td>
                            <select class="form-select" aria-label="Default Tipo de Compra" name="tcompra">
                                <option value="Contado" selected>Contado</option>
                                <option value="Credito">Credito</option>
                            </select>
                        </td>
                        <td>
                            <select class="form-select" aria-label="Default Metodo de Pago" name="mpago">
                                <option value="Efectivo" selected>Efectivo</option>
                                <option value="Tarjeta">Tarjeta</option>
                                <option value="Transferencia">Transferencia</option>
                                <option value="Transferencia">Otro</option>
                            </select>
                        </td>
                    </tr>
                </tbody>
            </table>

            <table id="tproductos">
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Cantidad</th>
                        <th>Costo</th>
                        <th>Acci√≥n</th>
                    </tr>
                </thead>
                <tbody class="table-group-divider">
                    <tr>
                        <td>
                            <input class="form-control" list="datalistproductosOptions" id="productosDataList" name="producto" placeholder="Escriba para buscar..." required>
                            <datalist id="datalistproductosOptions">
                            {% for producto in productos %}
                              <option value="{{ producto.nombre }}">
                            {% endfor %}
                            </datalist>
                            {% endif %}
                        </td>
                        <td>
                            <input type="number" class="form-control" placeholder="" value="1" inputmode="numeric" name="cantidad" maxlength="4" min="1" max="9999" id="cantidad">
                        </td>
                        <td>
                            <input type="number" class="form-control" placeholder="" value="0.00" inputmode="numeric" name="costo" maxlength="10" step="0.01" min="0" max="9999999999" id="costo">
                        </td>
                        <td>
                            <a onclick="agregar()"><img src="{{ url_for('static', filename='ico/add-plus.svg') }}" alt="" width="50" height="35" style="filter: invert(1)"></a>
                        </td>
                    </tr>
                    <script>
                        var n = 1;
                        function setValue(id, newvalue){
                            var s = document.getElementById(id);
                            s.value = newvalue;
                        } 
                        window.onload = function() {
                            setValue("item", n);
                            // console.log("valor de n es:" + n);
                        }
                        function agregar() {
                            if (n<10) {
                                var table = document.getElementById("tproductos")
                                var row = table.insertRow(-1);
                                var cell1 = row.insertCell(0);
                                var cell2 = row.insertCell(1);
                                var cell3 = row.insertCell(2);
                                var cell4 = row.insertCell(3);
                                cell1.innerHTML = '<input class="form-control" list="datalistproductosOptions" id="productosDataList'+ n +'" name="producto'+ n +'" placeholder="Escriba para buscar..." required>';
                                cell2.innerHTML = '<input type="number" class="form-control" placeholder="" value="1" inputmode="numeric" name="cantidad'+ n +'" maxlength="4" min="1" max="9999" id="cantidad'+ n +'">';
                                cell3.innerHTML = '<input type="number" class="form-control" placeholder="" value="0.00" inputmode="numeric" name="costo'+ n +'" maxlength="10" step="0.01" min="0" max="9999999999" id="costo'+ n +'">';
                                cell4.innerHTML = '<a onclick="agregar()"><img src="{{ url_for("static", filename="ico/add-plus.svg") }}" alt="" width="50" height="35" style="filter: invert(1)"></a><a onclick="eliminar()"><img src="{{ url_for("static", filename="ico/add-minus.svg") }}" alt="" width="50" height="35" style="filter: invert(1)"></a>';
                                ++n;
                                setValue("item", n);
                                console.log("valor de n es:" + n);
                            }
                        }   

                        function eliminar() {
                            document.getElementById("tproductos").deleteRow(-1);
                            --n
                            setValue("item", n);
                            console.log("valor de n es:" + n);
                        }
                    </script>
                </tbody>
            </table>
            <div>
                <input type="hidden" name="item" id="item">
            </div>
            <div class="d-flex justify-content-end">
                <div class="row mt-2">
                    <div class="col">
                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary btn-sm">Registrar</button>
                            <a href="{{ url_for('gcompras.compras') }}" class="btn btn-secondary btn-sm ">Retorno</a>
                            <a class="btn btn-secondary btn-sm" href="{{ url_for('login.logout') }}">Salir</a>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        
    </div>
</div>


{% endblock %}